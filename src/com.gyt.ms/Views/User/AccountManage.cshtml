@using System.Diagnostics
@using Zer.Entities
@using Zer.GytDto.Users

@{
    ViewBag.Title = "AccountManage";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var infoList = ViewBag.Result as List<UserInfoDto>;
}

<h3 class="header smaller lighter blue">帐号管理</h3>

    <div class="table-header">

        <div class="visible-sm visible-md hidden-sm hidden-xs action-buttons">
            <a class="white" id="btn_Add">
                <i class="icon-plus-sign bigger-110">
                    <span class="">新增用户</span>
                </i>
            </a>

            <a class="white" id="btn_Edit">
                <i class="icon-edit bigger-110">
                    <span class="">编辑用户</span>
                </i>
            </a>

            <a class="white" id="btn_Frozon">
                <i class="icon-lock bigger-110">
                    <span class="">冻结用户</span>
                </i>
            </a>
            
            <a class="white" id="btn_Thaw">
                <i class="icon-unlock bigger-110">
                    <span class="">解冻用户</span>
                </i>
            </a>
        </div>

    </div>

    <div class="table-responsive">
        <table id="tb_Info" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="center">
                        <label>
                            <input type="checkbox" class="ace">
                            <span class="lbl"></span>
                        </label>
                    </th>
                    <th>序号</th>
                    <th>用户名</th>
                    <th>用户姓名</th>
                    <th>邮箱</th>
                    <th>联系方式</th>
                    <th>状态</th>
                    <th>创建日期</th>
                    <!--link to log detail page, to view the logs with user-->
                    <th>日志信息</th>
                </tr>
            </thead>

            <tbody>

                @{
                    Debug.Assert(infoList != null, "infoList != null");
                }


                @foreach (var userInfoDto in infoList)
                {
                    <tr>
                        <td class="center">
                            <label>
                                <input type="checkbox" class="ace">
                                <span class="lbl"></span>
                            </label>
                        </td>
                        <td>@userInfoDto.UserId</td>

                        <td>
                            <a href="javascript:();">
                                @userInfoDto.UserName
                            </a>
                        </td>

                        <td>
                            @userInfoDto.DisplayName
                        </td>
                        <td>@userInfoDto.Email</td>
                        <td>
                            @userInfoDto.MobilePhone
                        </td>
                        <td>
                            <span class="@(userInfoDto.State == UserState.Active ? "label label-sm label-success" : "label label-sm label-danger")">@userInfoDto.State</span>
                        </td>
                        <td>2017/06/25</td>
                        <td class="hidden-480">
                            <a href="@Url.Action("UserLogInfo","LogInfo",new {userId=userInfoDto.UserId})">
                                详情
                            </a>
                        </td>
                    </tr>
                }

            </tbody>
        </table>

        <div class="row">
            <div class="col-sm-12">
                <div class="dataTables_paginate padding-10">
                    <ul class="pagination">
                        <li class="prev disabled">
                            <a href="#">
                                <i class="icon-double-angle-left"></i>
                            </a>
                        </li>
                        <li class="active">
                            <a href="#">1</a>
                        </li>
                        <li>
                            <a href="#">2</a>
                        </li>
                        <li>
                            <a href="#">3</a>
                        </li>
                        <li class="next">
                            <a href="#">
                                <i class="icon-double-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

@section scripts
{
    <script type="text/javascript">
    $(function () {
        $("#btn_Add")
            .click(function () {
                window.location = "@Url.Action("AddUserInfo")";
            });

        $("#btn_Edit")
            .click(function () {

                var ids = getSelectIds();

                if (ids.length > 0) {
                    window.location = "@Url.Action("EditUserInfo")&userId=" +
                        ids[0];
                }
            });

        $("#btn_Frozon")
            .click(function () {

                var ids = getSelectIds();

                if (ids.length > 0) {

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("Frozon")",
                        data: { userId: ids[0] },
                    dataType: "json",
                    success: function(data) {
                        window.location.href = "@Url.Action("AccountManage")";
                    }
                });
                }

            });
        $("#btn_Thaw")
            .click(function () {

                var ids = getSelectIds();

                if (ids.length > 0) {

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("Thaw")",
                        data: { userId: ids[0] },
                    dataType: "json",
                    success: function(data) {
                        window.location.href = "@Url.Action("AccountManage")";
                    }
                });
            }

        });
    });

    function getSelectIds() {
        var ids = [];
        var index = 0;

        var tbodyObj = document.getElementById('tb_Info');
        $("table :checkbox")
            .each(function (key, value) {
                if ($(value).prop('checked')) {
                    ids[index] = tbodyObj.rows[key].cells[1].innerHTML;
                    index++;
                }
            });
        return ids;
    }
    </script>
}
